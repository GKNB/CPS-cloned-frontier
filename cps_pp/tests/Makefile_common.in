#
#   This is the makefile for all the commands
#   that are common for all testing applications.
#
#
#


# This should point at the top level directory for the 
# cps code.
TOP=../../..

COMPILER = @CXX@
LDFLAGS = -lm


# TARGET_QCDSP = 1 for QCDSP build, 0 otherwise
TARGET_QCDSP = @TARGET_QCDSP@

# PARALLEL = 1 for parallel compilation, 0 for serial compilation 
PARALLEL = @PARALLEL@


#
# include list for the Columbia code
#
TOPINC=$(TOP)/cps++
INCLIST := -I$(TOPINC) -I$(TOPINC)/include 
ifeq "$(PARALLEL)" "1" 
ifeq "$(TARGET_QCDSP)" "0"
INCLIST := $(INCLIST) -I$(TOPINC)/include/comms
endif
endif

CFLAGS= @CXXFLAGS@ 

#
# Libraries for the Columbia code
#

LINLIB = "$(TOP)/cps++"
LIBLIST =\
  $(LINLIB)/cps.a \

#
#  targets
#

me = $(notdir $(PWD))

all:regression_cps.x 

regression_cps.x:  cps main.o
	$(COMPILER) -o regression_cps.x main.o $(LIBLIST) $(LDFLAGS)

main.o: main.C
	$(COMPILER) -o main.o $(CFLAGS) -c $(INCLIST) main.C 

cps: 
	cd $(TOPINC); $(MAKE)
#	$(MAKE) -C $(TOPINC)

clean:
	rm -f *.dat *.o  regression_cps.x 
	rm -f ../regressions/*$(me).dat
	rm -f ../regressions/*$(me).checklog
