dnl--------------------------------------------------------------------
dnl  CVS keywords
dnl
dnl  $Author: zs $
dnl  $Date: 2003-10-21 15:34:42 $
dnl  $Header: /home/chulwoo/CPS/repo/CVS/cps_only/cps_pp/configure.in,v 1.3 2003-10-21 15:34:42 zs Exp $
dnl  $Id: configure.in,v 1.3 2003-10-21 15:34:42 zs Exp $
dnl  $Name: not supported by cvs2svn $
dnl  $Locker:  $
dnl  $RCSfile: configure.in,v $
dnl  $Revision: 1.3 $
dnl  $Source: /home/chulwoo/CPS/repo/CVS/cps_only/cps_pp/configure.in,v $
dnl  $State: Exp $
dnl
dnl--------------------------------------------------------------------
AC_INIT(./src/)

dnl Get host information:

AC_CANONICAL_HOST
AC_CANONICAL_TARGET

dnl If using this script, then we are not making the QCDSP version.

NOT_TESTING_QCDSP="yes"
AC_SUBST(NOT_TESTING_QCDSP)
TARGET_QCDSP=0
AC_SUBST(TARGET_QCDSP)	

dnl Check for maths library

AC_CHECK_LIB(m, sin, ,echo "CPS needs the math library - bailing out"; exit 1)

dnl Parallel (MPI) v. serial switch.

AC_ARG_ENABLE(parallel-mpi, 
[  --enable-parallel-mpi   Compile as a parallel code, using MPI. (default=no)] ,  , [enable_parallel_mpi="no"])
AC_MSG_CHECKING([if parallel-mpi is enabled])
AC_MSG_RESULT($enable_parallel_mpi)
if test "$enable_parallel_mpi" = "yes"; then
  PARALLEL=1	
  AC_CHECK_PROGS(CXX, mpic++ mpiCC, g++)
  if test "$CXX" = "g++"; then
    AC_MSG_WARN([Using g++])
    AC_SEARCH_LIBS(MPI_Init, mpi mpich, ,echo "CPS needs the MPI library for a parallel build - bailing out."; exit 1)
  fi
  MPILINK="-lmpi"
  PARALLELLINK="MPILIB"
  TESTING_PARALLEL="yes";
else
  PARALLEL=0
  AC_PROG_CXX
  MPILINK=""
  PARALLELLINK="SERIALLIB"
  TESTING_PARALLEL="no";
fi
AC_SUBST(PARALLEL)
AC_SUBST(MPILINK)
AC_SUBST(PARALLELLINK)
AC_SUBST(TESTING_PARALLEL)

dnl Basic float/double precision switch:

AC_ARG_ENABLE(double-prec, 
[  --enable-double-prec    Force the code to use double precision throughout (default=yes)] ,  , [enable_double_precision="yes"])
AC_MSG_CHECKING([if double-prec is enabled])
AC_MSG_RESULT($enable_double_precision)
if test "$enable_double_precision" = "yes"; then
  GSUMPRECISION="double"
  LOCALPRECISION="double"
else
  GSUMPRECISION="double"
  LOCALPRECISION="float"
fi
AC_SUBST(GSUMPRECISION)
AC_SUBST(LOCALPRECISION)


dnl Set default value for CXXFLAGS if none is defined or it's empty

if test -z "$CXXFLAGS"; then
  CXXFLAGS="-O"
fi


topwd_srcdir=`pwd` 
AC_SUBST(topwd_srcdir)

AC_PROG_INSTALL

AC_CHECK_PROG(have_doxygen, doxygen, "yes")

AC_OUTPUT(Makefile_cps\
          tests/Makefile_common \
	  config.h \
          tests/regression.pl )

