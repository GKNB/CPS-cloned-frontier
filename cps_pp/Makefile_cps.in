# $Id: Makefile_cps.in,v 1.6 2003-07-30 16:30:16 zs Exp $
#
#  Template makefile for the Columbia Physics System
#  Need to add autoconf stuff
#
#  Create the library for CPS using: make cps
#
MAKEFILE = Makefile_cps


CC = @CC@
CXX = @CC@

top_srcdir = @topwd_srcdir@
INCLUDE_FLAGS = -I$(top_srcdir)  -I$(top_srcdir)/include




libcps_CXXFLAGS = -DPARALLEL=0 -DTARGET_QCDSP=0  $(INCLUDE_FLAGS) 


#
#   source from specific build options
#
include Makefile_cps_src

.SUFFIXES:

.SUFFIXES:      .o .C

#  go into the subdirectory and compile
%.o:%.C
	cd ${<D} ; g++ -c  ${<F} $(libcps_CXXFLAGS)




#
# make the library for the CPS code
#
cps: $(cps_obj)
	ar rcs cps.a ${cps_obj}

.PHONY : cps clean docs depend

# change the makefile ==> recompile
$(cps_obj): $(MAKEFILE) 

cps_SOURCES=  $(cps_obj:.o=.C)


have_doxygen = @have_doxygen@

ifneq "$(have_doxygen)" "yes"

docs webdocs:
	@echo doxygen must be installed to make the documentation.
else

docs:
	@$(SHELL) doc/mkdocs.sh 

#
#  documentation for the web pages
#  (this deletes the source code so that it is not posted on the web)

subdirs = $(dir $(shell ls doc/*/Makefile))
webdocs:
	@echo Creating documentation for the web page
	@echo This will delete all source code
	@rm -rf src include tests
	$(MAKE) -f $(MAKEFILE) docs
	@for a in $(subdirs); do $(MAKE) -C $$a all clean; done
	chmod o= `ls`
	@find doc -path "*CVS" -prune -o -type d -print | xargs chmod 775
	@find doc -name "*.html" -o -name "*.*ps" -o -name "*.gif" -o -name "*.png" -o -name "*.jp*g" -o -name "*.pdf" -o -name "*.tar.gz" |xargs chmod 644

endif

clean:
	rm -f $(cps_obj) cps.a
	@$(SHELL) doc/cleandocs.sh

##
## create dependencies
##
depend:	
	makedepend -f Makefile_depend  $(libcps_CXXFLAGS)  $(cps_SOURCES)

include Makefile_depend

